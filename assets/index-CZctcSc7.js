var j=function(){return{emit:function(t,r){for(var n=this.events[t]||[],o=0,s=n.length;o<s;o++)n[o](r)},events:{},on:function(t,r){var n=this,o,s;return((o=this.events)[s=t]||(o[s]=[])).push(r),function(){var i;n.events[t]=(i=n.events[t])===null||i===void 0?void 0:i.filter(function(d){return r!==d})}}}};typeof window<"u"&&(window.__GRANITE_NATIVE_EMITTER=j());var H=class{get _window(){return typeof window<"u"?window:{ReactNativeWebView:{postMessage:()=>{}},__GRANITE_NATIVE_EMITTER:{on:()=>()=>{}},__CONSTANT_HANDLER_MAP:{}}}postMessage(e){const t=this._window.ReactNativeWebView;if(!t)throw new Error("ReactNativeWebView is not available in browser environment");t.postMessage(JSON.stringify(e))}on(e,t){const r=this._window.__GRANITE_NATIVE_EMITTER;if(!r)throw new Error("__GRANITE_NATIVE_EMITTER is not available");return r.on(e,t)}getConstant(e){const t=this._window.__CONSTANT_HANDLER_MAP;if(t&&e in t)return t[e];throw new Error(`${e} is not a constant handler`)}},m=new H,x=()=>Math.random().toString(36).substring(2,15),D=e=>{if(e&&e.__isError){const t=new Error(e.message);for(const[r,n]of Object.entries(e))t[r]=n;return t}return e};function p(e){return(...t)=>{const r=x(),n=[],o=()=>{for(const s of n)s()};return new Promise((s,i)=>{n.push(m.on(`${e}/resolve/${r}`,d=>{o(),s(d)})),n.push(m.on(`${e}/reject/${r}`,d=>{o(),i(D(d))})),m.postMessage({type:"method",functionName:e,eventId:r,args:t})})}}function g(e){return t=>{const r=x(),n=[m.on(`${e}/onEvent/${r}`,o=>{t.onEvent(o)}),m.on(`${e}/onError/${r}`,o=>{t.onError(D(o))})];return m.postMessage({type:"addEventListener",functionName:e,eventId:r,args:t.options}),()=>{m.postMessage({type:"removeEventListener",functionName:e,eventId:r}),n.forEach(o=>o())}}}function A(e){return()=>m.getConstant(e)}var K=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\\-]+(?:\.[\da-z\\-]+)*))?(?:\+[\da-z\\-]+(?:\.[\da-z\\-]+)*)?)?)?$/i,C=e=>["*","x","X"].includes(e),L=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},W=(e,t)=>typeof e==typeof t?[e,t]:[String(e),String(t)],B=(e,t)=>{if(C(e)||C(t))return 0;const[r,n]=W(L(e),L(t));return r>n?1:r<n?-1:0},O=e=>{if(typeof e!="string")throw new TypeError("Invalid argument: expected a string");const t=e.match(K);if(!t)throw new Error(`Invalid semver: '${e}'`);const[,r,n,o,s,i]=t;return[r,n,o,s,i]},M=(e,t)=>{const r=Math.max(e.length,t.length);for(let n=0;n<r;n++){const o=e[n]??"0",s=t[n]??"0",i=B(o,s);if(i!==0)return i}return 0},q=(e,t)=>{const r=O(e),n=O(t),o=r.pop(),s=n.pop(),i=M(r,n);return i!==0?i:o&&s?M(o.split("."),s.split(".")):o?-1:s?1:0};function _(e){if(A("getOperationalEnvironment")()==="sandbox")return!0;const r=A("getTossAppVersion")(),o=A("getPlatformOS")()==="ios"?e.ios:e.android;return o===void 0?!1:o==="always"?!0:o==="never"?!1:q(r,o)>=0}function N(e){return p("processProductGrant")(e)}var P={createOneTimePurchaseOrder:e=>{const t=_({android:"5.219.0",ios:"5.219.0"}),r=()=>{};if(!t)return r;const n=_({android:"5.231.1",ios:"5.230.0"}),{options:o,onEvent:s,onError:i}=e,d=o.sku??o.productId;return n?g("requestOneTimePurchase")({options:{sku:d},onEvent:async u=>{if(u.type==="purchased"){const c=await o.processProductGrant({orderId:u.data.orderId});await N({orderId:u.data.orderId,isProductGranted:c}).catch(i)}else s(u)},onError:u=>{i(u)}}):(p("iapCreateOneTimePurchaseOrder")({productId:d}).then(c=>{Promise.resolve(o.processProductGrant({orderId:c.orderId})).then(()=>{s({type:"success",data:c})}).catch(T=>{i(T)})}).catch(c=>{i(c)}),r)},createSubscriptionPurchaseOrder:e=>{const t=_({android:"5.248.0",ios:"5.249.0"}),r=()=>{};if(!t)return r;const{options:n,onEvent:o,onError:s}=e,{sku:i,offerId:d,processProductGrant:a}=n;return g("requestSubscriptionPurchase")({options:{sku:i,offerId:d??null},onEvent:async c=>{if(c.type==="purchased"){const T=await a({orderId:c.data.orderId,subscriptionId:c.data.subscriptionId});await N({orderId:c.data.orderId,isProductGranted:T}).catch(s)}else o(c)},onError:c=>{s(c)}})},getProductItemList:p("iapGetProductItemList"),getPendingOrders:p("getPendingOrders"),getCompletedOrRefundedOrders:p("getCompletedOrRefundedOrders"),completeProductGrant:p("completeProductGrant")},l={loadAppsInTossAdMob:Object.assign(g("loadAppsInTossAdMob"),{isSupported:A("loadAppsInTossAdMob_isSupported")}),showAppsInTossAdMob:Object.assign(g("showAppsInTossAdMob"),{isSupported:A("showAppsInTossAdMob_isSupported")}),isAppsInTossAdMobLoaded:Object.assign(p("isAppsInTossAdMobLoaded"),{isSupported:A("isAppsInTossAdMobLoaded_isSupported")})};Object.assign(g("loadFullScreenAd"),{isSupported:A("loadFullScreenAd_isSupported")});Object.assign(g("showFullScreenAd"),{isSupported:A("showFullScreenAd_isSupported")});var X=p("openURL");function Y(e){const t=J(e);return X(t)}function J(e){return["http://","https://"].some(r=>e.startsWith(r))?Q(e):e}function Q(e){return`supertoss://web?url=${encodeURIComponent(e)}&external=true`}var R="https://static.toss.im/ads/sdk/toss-ads-space-kit-1.3.0.js",k=15e3,b=null;function I(){if(!(typeof window>"u"))return window.TossAdsSpaceKit}function Z(){if(typeof window>"u"||typeof document>"u")return Promise.reject(new Error("Ads SDK can only be loaded in a browser environment."));const e=I();if(e)return Promise.resolve(e);if(b)return b;const t=new Promise((r,n)=>{const o=document.createElement("script"),s=()=>{o.removeEventListener("load",i),o.removeEventListener("error",d),window.clearTimeout(a),b=null},i=()=>{const u=I();if(u){s(),r(u);return}s(),n(new Error("Ads SDK script loaded but window.TossAdsSpaceKit was not exposed."))},d=()=>{s(),n(new Error(`Failed to load Ads SDK script from ${R}.`))},a=window.setTimeout(()=>{s(),n(new Error(`Loading Ads SDK timed out after ${k}ms.`))},k);o.addEventListener("load",i),o.addEventListener("error",d),o.async=!0,o.src=R,document.head.appendChild(o)});return b=t,t}var w=Object.assign(g("fetchTossAd"),{isSupported:A("fetchTossAd_isSupported")}),ee=p("tossAdEventLog"),te=new Set(["1","2"]);function re(e){return new Promise((t,r)=>{if(!w.isSupported()){r(new Error("fetchTossAd is not supported in this environment."));return}return w({options:e,onEvent:t,onError:r})})}function G(e){const t=Array.isArray(e.ads)?e.ads.filter(r=>te.has(String(r.styleId))):[];return{requestId:e.requestId??"",status:e.status??"OK",ads:t,ext:e.ext}}function ne(e){return oe(e)?e.resultType!=="SUCCESS"?e:e.success?{...e,success:G(e.success)}:{resultType:"FAIL",error:{reason:"fetchTossAd returned SUCCESS without payload"}}:se(e)?{resultType:"SUCCESS",success:G(e)}:{resultType:"FAIL",error:{reason:"Invalid response from fetchTossAd"}}}function oe(e){return!!(e&&typeof e=="object"&&"resultType"in e)}function se(e){return!!(e&&typeof e=="object"&&"ads"in e)}function ie(){return async(e,t)=>{try{const r=await re({adGroupId:t.spaceUnitId,sdkId:"108",availableStyleIds:["1","2"]});return ne(r)}catch(r){return{resultType:"FAIL",error:{reason:r instanceof Error?r.message:"Unknown fetchTossAd error"}}}}}var S=null;function de(e){const{callbacks:t}=e,r=()=>t?.onInitialized?.(),n=i=>{const d=i instanceof Error?i:new Error(String(i));t?.onInitializationFailed?.(d)};if(I()?.isInitialized()){r();return}if(S!=null){S.then(r).catch(n);return}const s=Z().then(i=>{if(i.isInitialized())return;const a={environment:"live",customAdFetcher:ie(),opener:Y};i.init(a)});S=s,s.then(r).catch(n).finally(()=>{S===s&&(S=null)})}function ae(e,t,r={}){const{callbacks:n}=r,o=s=>{const i=s instanceof Error?s:new Error(String(s));n?.onAdFailedToRender?.({slotId:"",adGroupId:e,adMetadata:{},error:{code:0,message:i.message}})};try{const s=e,i=I();if(!i)throw new Error("[toss-ad] Call initialize() before attaching an ad.");if(!i.banner)throw new Error("[toss-ad] Loaded TossAdsSpaceKit does not support banner ads.");const d=typeof t=="string"?document.querySelector(t):t;if(!d)throw new Error(`[toss-ad] Failed to find target element: ${t}`);const a={spaceId:s,autoLoad:!0,theme:r.theme,padding:r.padding,callbacks:$(e,r.callbacks)};i.banner.createSlot(d,a)}catch(s){o(s)}}var ce="16px 20px",ue="20px",pe="auto",le="blackAndWhite",fe="expanded",h="toss-ads-attach",F="toss-ads-attach-style";function Ae(e){const t=e.ownerDocument;if(!t||t.getElementById(F))return;const r=t.createElement("style");r.id=F,r.textContent=`
    .${h} { background: #ffffff; }
    .${h}.toss-ads-tone-grey { background: #f2f4f7; }
    @media (prefers-color-scheme: dark) {
      .${h} { background: #17171c; }
      .${h}.toss-ads-tone-grey { background: #101013; }
    }
    .${h}.toss-ads-theme-light { background: #ffffff; }
    .${h}.toss-ads-theme-light.toss-ads-tone-grey { background: #f2f4f7; }
    .${h}.toss-ads-theme-dark { background: #17171c; }
    .${h}.toss-ads-theme-dark.toss-ads-tone-grey { background: #101013; }
  `;const n=t.head??t.body??t.documentElement;n&&n.appendChild(r)}function he(e,t,r={}){const{callbacks:n,theme:o=pe,tone:s=le,variant:i=fe}=r,d=document.createElement("div");d.style.width="100%",d.style.height="100%",d.style.boxSizing="border-box",d.style.display="flex",d.style.flexDirection="column",d.style.justifyContent="center",d.style.overflow="hidden",i==="card"&&(d.style.padding="0 10px");const a=document.createElement("div");a.classList.add(h),s==="grey"&&a.classList.add("toss-ads-tone-grey"),o==="light"?a.classList.add("toss-ads-theme-light"):o==="dark"&&a.classList.add("toss-ads-theme-dark"),i==="card"&&(a.style.borderRadius="16px",a.style.overflow="hidden"),d.appendChild(a);let u=!1,c=null;const T=E=>{const v=E instanceof Error?E:new Error(String(E));n?.onAdFailedToRender?.({slotId:"",adGroupId:e,adMetadata:{},error:{code:0,message:v.message}})},U=$(e,n);try{const E=e,v=I();if(!v)throw new Error("[toss-ad] Call initialize() before attaching an ad.");if(!v.banner)throw new Error("[toss-ad] Loaded TossAdsSpaceKit does not support banner ads.");const y=typeof t=="string"?document.querySelector(t):t;if(!y)throw new Error(`[toss-ad] Failed to find target element: ${t}`);Ae(y),y.appendChild(d),u=!0;const z={spaceId:E,autoLoad:!0,theme:o==="auto"?void 0:o,renderPadding:V=>V==="1"?ce:ue,callbacks:U};c=v.banner.createSlot(a,z)}catch(E){u&&d.parentNode&&d.parentNode.removeChild(d),T(E)}return{destroy(){c?.destroy(),u&&d.parentNode&&d.parentNode.removeChild(d)}}}function me(e){const t=I();t?.banner&&t.banner.destroy(e)}function Ee(){const e=I();e?.banner&&e.banner.destroyAll()}function $(e,t){if(!t)return;const r=n=>{const o={...n??{}};return o.adGroupId=o.adGroupId??o.spaceId??e,delete o.spaceId,o};return{onAdRendered:n=>t.onAdRendered?.(r(n)),onAdViewable:n=>t.onAdViewable?.(r(n)),onAdClicked:n=>t.onAdClicked?.(r(n)),onAdImpression:n=>{ee({log_name:"display_ads_all::impression__1px_banner",log_type:"event",params:{event_type:"impression",schema_id:1812034,request_id:n?.adMetadata?.requestId??""}}),t.onAdImpression?.(r(n))},onAdFailedToRender:n=>t.onAdFailedToRender?.({...r(n),error:n?.error??{code:0,message:"UNKNOWN"}}),onNoFill:n=>t.onNoFill?.(r(n))}}Object.assign(de,{isSupported:w.isSupported}),Object.assign(ae,{isSupported:w.isSupported}),Object.assign(he,{isSupported:w.isSupported}),Object.assign(me,{isSupported:w.isSupported}),Object.assign(Ee,{isSupported:w.isSupported});Object.assign(p("getServerTime"),{isSupported:A("getServerTime_isSupported")});const ge="toss",f={rewarded:"ait-ad-test-rewarded-id",interstitial:"ait-ad-test-interstitial-id"},we="coffee_5cups";function Ie(){l.loadAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:()=>{},onError:e=>console.warn("[toss] 리워드 광고 프리로드 실패:",e)}),l.loadAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:()=>{},onError:e=>console.warn("[toss] 전면 광고 프리로드 실패:",e)})}function Te(){return new Promise(e=>{l.isAppsInTossAdMobLoaded({adGroupId:f.rewarded}).then(t=>{const r=()=>{let n=!1;const o=l.showAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:s=>{s.type==="userEarnedReward"&&(n=!0),(s.type==="dismissed"||s.type==="failedToShow")&&(o(),l.loadAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:()=>{},onError:()=>{}}),e(n))},onError:s=>{console.warn("[toss] 리워드 광고 표시 실패:",s),o(),e(!1)}})};if(t)r();else{const n=l.loadAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:o=>{o.type==="loaded"&&(n(),r())},onError:o=>{console.warn("[toss] 리워드 광고 로드 실패:",o),n(),e(!1)}})}}).catch(t=>{console.warn("[toss] 리워드 광고 로드 상태 확인 실패:",t),e(!1)})})}function ve(){return new Promise(e=>{l.isAppsInTossAdMobLoaded({adGroupId:f.interstitial}).then(t=>{const r=()=>{const n=l.showAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:o=>{(o.type==="dismissed"||o.type==="failedToShow")&&(n(),l.loadAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:()=>{},onError:()=>{}}),e(o.type==="dismissed"))},onError:o=>{console.warn("[toss] 전면 광고 표시 실패:",o),n(),e(!1)}})};if(t)r();else{const n=l.loadAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:o=>{o.type==="loaded"&&(n(),r())},onError:o=>{console.warn("[toss] 전면 광고 로드 실패:",o),n(),e(!1)}})}}).catch(t=>{console.warn("[toss] 전면 광고 로드 상태 확인 실패:",t),e(!1)})})}function Se(){return new Promise(e=>{const t=P.createOneTimePurchaseOrder({options:{sku:we,processProductGrant:r=>!0},onEvent:r=>{t(),e(!0)},onError:r=>{t(),e(!1)}})})}async function be(){try{const t=(await P.getPendingOrders())?.orders??[];for(const r of t)await P.completeProductGrant({params:{orderId:r.orderId}})}catch(e){console.warn("[toss] 미지급 주문 복원 실패:",e)}}export{ge as PLATFORM,Ie as initAds,Se as purchaseCoffee,be as restorePendingPurchases,ve as showInterstitialAd,Te as showRewardedAd};
