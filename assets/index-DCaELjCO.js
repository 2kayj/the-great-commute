var H=class{get _window(){return typeof window<"u"?window:{ReactNativeWebView:{postMessage:()=>{}},__GRANITE_NATIVE_EMITTER:{on:()=>()=>{}},__CONSTANT_HANDLER_MAP:{}}}postMessage(t){const r=this._window.ReactNativeWebView;if(!r)throw new Error("ReactNativeWebView is not available in browser environment");r.postMessage(JSON.stringify(t))}on(t,r){const n=this._window.__GRANITE_NATIVE_EMITTER;if(!n)throw new Error("__GRANITE_NATIVE_EMITTER is not available");return n.on(t,r)}getConstant(t){const r=this._window.__CONSTANT_HANDLER_MAP;if(r&&t in r)return r[t];throw new Error(`${t} is not a constant handler`)}},y=new H,B=()=>Math.random().toString(36).substring(2,15),K=e=>{if(e&&e.__isError){const t=new Error(e.message);for(const[r,n]of Object.entries(e))t[r]=n;return t}return e};function x(e){return(...t)=>{const r=B(),n=[],o=()=>{for(const s of n)s()};return new Promise((s,i)=>{n.push(y.on(`${e}/resolve/${r}`,a=>{o(),s(a)})),n.push(y.on(`${e}/reject/${r}`,a=>{o(),i(K(a))})),y.postMessage({type:"method",functionName:e,eventId:r,args:t})})}}var q=function(){return{emit:function(t,r){for(var n=this.events[t]||[],o=0,s=n.length;o<s;o++)n[o](r)},events:{},on:function(t,r){var n=this,o,s;return((o=this.events)[s=t]||(o[s]=[])).push(r),function(){var i;n.events[t]=(i=n.events[t])===null||i===void 0?void 0:i.filter(function(a){return r!==a})}}}};typeof window<"u"&&(window.__GRANITE_NATIVE_EMITTER=q());var J=x("openGameCenterLeaderboard"),X=x("submitGameCenterLeaderBoardScore"),Y=class{get _window(){return typeof window<"u"?window:{ReactNativeWebView:{postMessage:()=>{}},__GRANITE_NATIVE_EMITTER:{on:()=>()=>{}},__CONSTANT_HANDLER_MAP:{}}}postMessage(e){const t=this._window.ReactNativeWebView;if(!t)throw new Error("ReactNativeWebView is not available in browser environment");t.postMessage(JSON.stringify(e))}on(e,t){const r=this._window.__GRANITE_NATIVE_EMITTER;if(!r)throw new Error("__GRANITE_NATIVE_EMITTER is not available");return r.on(e,t)}getConstant(e){const t=this._window.__CONSTANT_HANDLER_MAP;if(t&&e in t)return t[e];throw new Error(`${e} is not a constant handler`)}},E=new Y,V=()=>Math.random().toString(36).substring(2,15),D=e=>{if(e&&e.__isError){const t=new Error(e.message);for(const[r,n]of Object.entries(e))t[r]=n;return t}return e};function p(e){return(...t)=>{const r=V(),n=[],o=()=>{for(const s of n)s()};return new Promise((s,i)=>{n.push(E.on(`${e}/resolve/${r}`,a=>{o(),s(a)})),n.push(E.on(`${e}/reject/${r}`,a=>{o(),i(D(a))})),E.postMessage({type:"method",functionName:e,eventId:r,args:t})})}}function g(e){return t=>{const r=V(),n=[E.on(`${e}/onEvent/${r}`,o=>{t.onEvent(o)}),E.on(`${e}/onError/${r}`,o=>{t.onError(D(o))})];return E.postMessage({type:"addEventListener",functionName:e,eventId:r,args:t.options}),()=>{E.postMessage({type:"removeEventListener",functionName:e,eventId:r}),n.forEach(o=>o())}}}function A(e){return()=>E.getConstant(e)}var Q=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\\-]+(?:\.[\da-z\\-]+)*))?(?:\+[\da-z\\-]+(?:\.[\da-z\\-]+)*)?)?)?$/i,M=e=>["*","x","X"].includes(e),P=e=>{const t=parseInt(e,10);return isNaN(t)?e:t},Z=(e,t)=>typeof e==typeof t?[e,t]:[String(e),String(t)],ee=(e,t)=>{if(M(e)||M(t))return 0;const[r,n]=Z(P(e),P(t));return r>n?1:r<n?-1:0},L=e=>{if(typeof e!="string")throw new TypeError("Invalid argument: expected a string");const t=e.match(Q);if(!t)throw new Error(`Invalid semver: '${e}'`);const[,r,n,o,s,i]=t;return[r,n,o,s,i]},O=(e,t)=>{const r=Math.max(e.length,t.length);for(let n=0;n<r;n++){const o=e[n]??"0",s=t[n]??"0",i=ee(o,s);if(i!==0)return i}return 0},te=(e,t)=>{const r=L(e),n=L(t),o=r.pop(),s=n.pop(),i=O(r,n);return i!==0?i:o&&s?O(o.split("."),s.split(".")):o?-1:s?1:0};function N(e){if(A("getOperationalEnvironment")()==="sandbox")return!0;const r=A("getTossAppVersion")(),o=A("getPlatformOS")()==="ios"?e.ios:e.android;return o===void 0?!1:o==="always"?!0:o==="never"?!1:te(r,o)>=0}function R(e){return p("processProductGrant")(e)}var C={createOneTimePurchaseOrder:e=>{const t=N({android:"5.219.0",ios:"5.219.0"}),r=()=>{};if(!t)return r;const n=N({android:"5.231.1",ios:"5.230.0"}),{options:o,onEvent:s,onError:i}=e,a=o.sku??o.productId;return n?g("requestOneTimePurchase")({options:{sku:a},onEvent:async u=>{if(u.type==="purchased"){const c=await o.processProductGrant({orderId:u.data.orderId});await R({orderId:u.data.orderId,isProductGranted:c}).catch(i)}else s(u)},onError:u=>{i(u)}}):(p("iapCreateOneTimePurchaseOrder")({productId:a}).then(c=>{Promise.resolve(o.processProductGrant({orderId:c.orderId})).then(()=>{s({type:"success",data:c})}).catch(I=>{i(I)})}).catch(c=>{i(c)}),r)},createSubscriptionPurchaseOrder:e=>{const t=N({android:"5.248.0",ios:"5.249.0"}),r=()=>{};if(!t)return r;const{options:n,onEvent:o,onError:s}=e,{sku:i,offerId:a,processProductGrant:d}=n;return g("requestSubscriptionPurchase")({options:{sku:i,offerId:a??null},onEvent:async c=>{if(c.type==="purchased"){const I=await d({orderId:c.data.orderId,subscriptionId:c.data.subscriptionId});await R({orderId:c.data.orderId,isProductGranted:I}).catch(s)}else o(c)},onError:c=>{s(c)}})},getProductItemList:p("iapGetProductItemList"),getPendingOrders:p("getPendingOrders"),getCompletedOrRefundedOrders:p("getCompletedOrRefundedOrders"),completeProductGrant:p("completeProductGrant")},l={loadAppsInTossAdMob:Object.assign(g("loadAppsInTossAdMob"),{isSupported:A("loadAppsInTossAdMob_isSupported")}),showAppsInTossAdMob:Object.assign(g("showAppsInTossAdMob"),{isSupported:A("showAppsInTossAdMob_isSupported")}),isAppsInTossAdMobLoaded:Object.assign(p("isAppsInTossAdMobLoaded"),{isSupported:A("isAppsInTossAdMobLoaded_isSupported")})};Object.assign(g("loadFullScreenAd"),{isSupported:A("loadFullScreenAd_isSupported")});Object.assign(g("showFullScreenAd"),{isSupported:A("showFullScreenAd_isSupported")});var re=p("openURL");function ne(e){const t=oe(e);return re(t)}function oe(e){return["http://","https://"].some(r=>e.startsWith(r))?se(e):e}function se(e){return`supertoss://web?url=${encodeURIComponent(e)}&external=true`}var G="https://static.toss.im/ads/sdk/toss-ads-space-kit-1.3.0.js",k=15e3,S=null;function T(){if(!(typeof window>"u"))return window.TossAdsSpaceKit}function ie(){if(typeof window>"u"||typeof document>"u")return Promise.reject(new Error("Ads SDK can only be loaded in a browser environment."));const e=T();if(e)return Promise.resolve(e);if(S)return S;const t=new Promise((r,n)=>{const o=document.createElement("script"),s=()=>{o.removeEventListener("load",i),o.removeEventListener("error",a),window.clearTimeout(d),S=null},i=()=>{const u=T();if(u){s(),r(u);return}s(),n(new Error("Ads SDK script loaded but window.TossAdsSpaceKit was not exposed."))},a=()=>{s(),n(new Error(`Failed to load Ads SDK script from ${G}.`))},d=window.setTimeout(()=>{s(),n(new Error(`Loading Ads SDK timed out after ${k}ms.`))},k);o.addEventListener("load",i),o.addEventListener("error",a),o.async=!0,o.src=G,document.head.appendChild(o)});return S=t,t}var m=Object.assign(g("fetchTossAd"),{isSupported:A("fetchTossAd_isSupported")}),ae=p("tossAdEventLog"),de=new Set(["1","2"]);function ce(e){return new Promise((t,r)=>{if(!m.isSupported()){r(new Error("fetchTossAd is not supported in this environment."));return}return m({options:e,onEvent:t,onError:r})})}function $(e){const t=Array.isArray(e.ads)?e.ads.filter(r=>de.has(String(r.styleId))):[];return{requestId:e.requestId??"",status:e.status??"OK",ads:t,ext:e.ext}}function ue(e){return pe(e)?e.resultType!=="SUCCESS"?e:e.success?{...e,success:$(e.success)}:{resultType:"FAIL",error:{reason:"fetchTossAd returned SUCCESS without payload"}}:le(e)?{resultType:"SUCCESS",success:$(e)}:{resultType:"FAIL",error:{reason:"Invalid response from fetchTossAd"}}}function pe(e){return!!(e&&typeof e=="object"&&"resultType"in e)}function le(e){return!!(e&&typeof e=="object"&&"ads"in e)}function fe(){return async(e,t)=>{try{const r=await ce({adGroupId:t.spaceUnitId,sdkId:"108",availableStyleIds:["1","2"]});return ue(r)}catch(r){return{resultType:"FAIL",error:{reason:r instanceof Error?r.message:"Unknown fetchTossAd error"}}}}}var _=null;function Ae(e){const{callbacks:t}=e,r=()=>t?.onInitialized?.(),n=i=>{const a=i instanceof Error?i:new Error(String(i));t?.onInitializationFailed?.(a)};if(T()?.isInitialized()){r();return}if(_!=null){_.then(r).catch(n);return}const s=ie().then(i=>{if(i.isInitialized())return;const d={environment:"live",customAdFetcher:fe(),opener:ne};i.init(d)});_=s,s.then(r).catch(n).finally(()=>{_===s&&(_=null)})}function we(e,t,r={}){const{callbacks:n}=r,o=s=>{const i=s instanceof Error?s:new Error(String(s));n?.onAdFailedToRender?.({slotId:"",adGroupId:e,adMetadata:{},error:{code:0,message:i.message}})};try{const s=e,i=T();if(!i)throw new Error("[toss-ad] Call initialize() before attaching an ad.");if(!i.banner)throw new Error("[toss-ad] Loaded TossAdsSpaceKit does not support banner ads.");const a=typeof t=="string"?document.querySelector(t):t;if(!a)throw new Error(`[toss-ad] Failed to find target element: ${t}`);const d={spaceId:s,autoLoad:!0,theme:r.theme,padding:r.padding,callbacks:U(e,r.callbacks)};i.banner.createSlot(a,d)}catch(s){o(s)}}var Ee="16px 20px",he="20px",me="auto",ge="blackAndWhite",Te="expanded",w="toss-ads-attach",F="toss-ads-attach-style";function Ie(e){const t=e.ownerDocument;if(!t||t.getElementById(F))return;const r=t.createElement("style");r.id=F,r.textContent=`
    .${w} { background: #ffffff; }
    .${w}.toss-ads-tone-grey { background: #f2f4f7; }
    @media (prefers-color-scheme: dark) {
      .${w} { background: #17171c; }
      .${w}.toss-ads-tone-grey { background: #101013; }
    }
    .${w}.toss-ads-theme-light { background: #ffffff; }
    .${w}.toss-ads-theme-light.toss-ads-tone-grey { background: #f2f4f7; }
    .${w}.toss-ads-theme-dark { background: #17171c; }
    .${w}.toss-ads-theme-dark.toss-ads-tone-grey { background: #101013; }
  `;const n=t.head??t.body??t.documentElement;n&&n.appendChild(r)}function ve(e,t,r={}){const{callbacks:n,theme:o=me,tone:s=ge,variant:i=Te}=r,a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.boxSizing="border-box",a.style.display="flex",a.style.flexDirection="column",a.style.justifyContent="center",a.style.overflow="hidden",i==="card"&&(a.style.padding="0 10px");const d=document.createElement("div");d.classList.add(w),s==="grey"&&d.classList.add("toss-ads-tone-grey"),o==="light"?d.classList.add("toss-ads-theme-light"):o==="dark"&&d.classList.add("toss-ads-theme-dark"),i==="card"&&(d.style.borderRadius="16px",d.style.overflow="hidden"),a.appendChild(d);let u=!1,c=null;const I=h=>{const v=h instanceof Error?h:new Error(String(h));n?.onAdFailedToRender?.({slotId:"",adGroupId:e,adMetadata:{},error:{code:0,message:v.message}})},j=U(e,n);try{const h=e,v=T();if(!v)throw new Error("[toss-ad] Call initialize() before attaching an ad.");if(!v.banner)throw new Error("[toss-ad] Loaded TossAdsSpaceKit does not support banner ads.");const b=typeof t=="string"?document.querySelector(t):t;if(!b)throw new Error(`[toss-ad] Failed to find target element: ${t}`);Ie(b),b.appendChild(a),u=!0;const z={spaceId:h,autoLoad:!0,theme:o==="auto"?void 0:o,renderPadding:W=>W==="1"?Ee:he,callbacks:j};c=v.banner.createSlot(d,z)}catch(h){u&&a.parentNode&&a.parentNode.removeChild(a),I(h)}return{destroy(){c?.destroy(),u&&a.parentNode&&a.parentNode.removeChild(a)}}}function _e(e){const t=T();t?.banner&&t.banner.destroy(e)}function Se(){const e=T();e?.banner&&e.banner.destroyAll()}function U(e,t){if(!t)return;const r=n=>{const o={...n??{}};return o.adGroupId=o.adGroupId??o.spaceId??e,delete o.spaceId,o};return{onAdRendered:n=>t.onAdRendered?.(r(n)),onAdViewable:n=>t.onAdViewable?.(r(n)),onAdClicked:n=>t.onAdClicked?.(r(n)),onAdImpression:n=>{ae({log_name:"display_ads_all::impression__1px_banner",log_type:"event",params:{event_type:"impression",schema_id:1812034,request_id:n?.adMetadata?.requestId??""}}),t.onAdImpression?.(r(n))},onAdFailedToRender:n=>t.onAdFailedToRender?.({...r(n),error:n?.error??{code:0,message:"UNKNOWN"}}),onNoFill:n=>t.onNoFill?.(r(n))}}Object.assign(Ae,{isSupported:m.isSupported}),Object.assign(we,{isSupported:m.isSupported}),Object.assign(ve,{isSupported:m.isSupported}),Object.assign(_e,{isSupported:m.isSupported}),Object.assign(Se,{isSupported:m.isSupported});Object.assign(p("getServerTime"),{isSupported:A("getServerTime_isSupported")});const Ne="toss",f={rewarded:"ait-ad-test-rewarded-id",interstitial:"ait-ad-test-interstitial-id"},be="coffee_5cups";function Ce(){l.loadAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:()=>{},onError:e=>console.warn("[toss] 리워드 광고 프리로드 실패:",e)}),l.loadAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:()=>{},onError:e=>console.warn("[toss] 전면 광고 프리로드 실패:",e)})}function Me(){return new Promise(e=>{l.isAppsInTossAdMobLoaded({adGroupId:f.rewarded}).then(t=>{const r=()=>{let n=!1;const o=l.showAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:s=>{s.type==="userEarnedReward"&&(n=!0),(s.type==="dismissed"||s.type==="failedToShow")&&(o(),l.loadAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:()=>{},onError:()=>{}}),e(n))},onError:s=>{console.warn("[toss] 리워드 광고 표시 실패:",s),o(),e(!1)}})};if(t)r();else{const n=l.loadAppsInTossAdMob({options:{adGroupId:f.rewarded},onEvent:o=>{o.type==="loaded"&&(n(),r())},onError:o=>{console.warn("[toss] 리워드 광고 로드 실패:",o),n(),e(!1)}})}}).catch(t=>{console.warn("[toss] 리워드 광고 로드 상태 확인 실패:",t),e(!1)})})}function Pe(){return new Promise(e=>{l.isAppsInTossAdMobLoaded({adGroupId:f.interstitial}).then(t=>{const r=()=>{const n=l.showAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:o=>{(o.type==="dismissed"||o.type==="failedToShow")&&(n(),l.loadAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:()=>{},onError:()=>{}}),e(o.type==="dismissed"))},onError:o=>{console.warn("[toss] 전면 광고 표시 실패:",o),n(),e(!1)}})};if(t)r();else{const n=l.loadAppsInTossAdMob({options:{adGroupId:f.interstitial},onEvent:o=>{o.type==="loaded"&&(n(),r())},onError:o=>{console.warn("[toss] 전면 광고 로드 실패:",o),n(),e(!1)}})}}).catch(t=>{console.warn("[toss] 전면 광고 로드 상태 확인 실패:",t),e(!1)})})}function Le(){return new Promise(e=>{const t=C.createOneTimePurchaseOrder({options:{sku:be,processProductGrant:r=>!0},onEvent:r=>{t(),e(!0)},onError:r=>{t(),e(!1)}})})}async function Oe(){try{const t=(await C.getPendingOrders())?.orders??[];for(const r of t)await C.completeProductGrant({params:{orderId:r.orderId}})}catch(e){console.warn("[toss] 미지급 주문 복원 실패:",e)}}async function Re(e){try{return(await X({score:String(e)}))?.statusCode==="SUCCESS"}catch(t){return console.warn("[toss] 리더보드 점수 제출 실패:",t),!1}}async function Ge(){try{await J()}catch(e){console.warn("[toss] 리더보드 열기 실패:",e)}}export{Ne as PLATFORM,Ce as initAds,Ge as openLeaderboard,Le as purchaseCoffee,Oe as restorePendingPurchases,Pe as showInterstitialAd,Me as showRewardedAd,Re as submitScore};
